<?xml version="1.0" encoding="UTF-8"?>

<project name="ETL" basedir=".">

	<property environment="env" />

	<property file="./db.properties" />

	<!-- =================================================================== -->
	<!-- 								INIT 								 -->
	<!-- =================================================================== -->
	<target name="init"  description="Prepare for build">
		<path id="classpath">
			<pathelement location="./snowflake-jdbc-3.13.29.jar"/>
		</path>
	</target>

	
	<!-- =================================================================== -->
	<!-- 								ETL 								 -->
	<!-- =================================================================== -->
	<target name="perform_etl" depends="init">
		<sql driver="${db.driver}" url="${db.url}" userid="${db.username}" password="${db.password}" classpathref="classpath" onerror="abort" autocommit="true">
			<!-- init-->
			<transaction src="./SCRIPTS/OTHER/${db.project}/init.sql" />
			<!-- Dimensions-->
			<transaction src="./SCRIPTS/DIMENSION_TABLES/${db.project}/patient_dimension.sql" />
			<transaction src="./SCRIPTS/DIMENSION_TABLES/${db.project}/provider_dimension.sql" />
			<transaction src="./SCRIPTS/DIMENSION_TABLES/${db.project}/visit_dimension.sql" />
			<!-- Facts-->
			<transaction src="./SCRIPTS/FACT_TABLES/${db.project}/observation_fact.sql" />
			<transaction src="./SCRIPTS/FACT_TABLES/${db.project}/demographic_fact.sql" />
			<transaction src="./SCRIPTS/FACT_TABLES/${db.project}/visit_fact.sql" />
			<transaction src="./SCRIPTS/FACT_TABLES/${db.project}/diagnosis_fact.sql" />
			<transaction src="./SCRIPTS/FACT_TABLES/${db.project}/procedure_fact.sql" />
			<transaction src="./SCRIPTS/FACT_TABLES/${db.project}/lab_fact.sql" />
			<transaction src="./SCRIPTS/FACT_TABLES/${db.project}/medication_fact.sql" />
			<transaction src="./SCRIPTS/FACT_TABLES/${db.project}/covid_fact.sql" />
			<transaction src="./SCRIPTS/FACT_TABLES/${db.project}/vital_fact.sql" />
			<transaction src="./SCRIPTS/FACT_TABLES/${db.project}/sdoh_fact.sql" />
			<transaction src="./SCRIPTS/FACT_TABLES/${db.project}/obsclin_fact.sql" />
			<!-- TARGET-->
			<transaction src="./SCRIPTS/OTHER/${db.project}/data-migration.sql" />
		</sql>
	</target>
</project>
