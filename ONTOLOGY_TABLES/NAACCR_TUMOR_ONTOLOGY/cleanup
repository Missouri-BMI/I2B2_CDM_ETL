#!/bin/bash
set -e

# CONNECT TO SNOWFLAKE
snowsql -c etl_user <<- EOSQL
DELETE FROM TABLE_ACCESS
WHERE C_TABLE_NAME = 'NAACCR_ONTOLOGY';

Insert into TABLE_ACCESS (C_TABLE_CD,C_TABLE_NAME,C_PROTECTED_ACCESS,C_HLEVEL,C_FULLNAME,C_NAME,C_SYNONYM_CD,
    C_VISUALATTRIBUTES,C_TOTALNUM,C_BASECODE,C_FACTTABLECOLUMN,C_DIMTABLENAME,C_COLUMNNAME,C_COLUMNDATATYPE,C_OPERATOR,C_DIMCODE,
    C_TOOLTIP,C_ENTRY_DATE,C_CHANGE_DATE,C_STATUS_CD,VALUETYPE_CD)
select
    'NAACCR_ONTOLOGY'
    , 'NAACCR_ONTOLOGY'
    , 'N'
    , c_hlevel
    , C_FULLNAME
    , C_NAME
    , C_SYNONYM_CD
    , C_VISUALATTRIBUTES
    , null
    , C_BASECODE
    , C_FACTTABLECOLUMN
    , C_DIMTABLENAME
    , C_COLUMNNAME
    , C_COLUMNDATATYPE
    , C_OPERATOR
    , C_DIMCODE
    , C_TOOLTIP
    , null
    , null
    , null
    , null
from NAACCR_ONTOLOGY
where c_hlevel = 1
;

delete from i2b2data.concept_dimension
where concept_path like '\\i2b2\\naaccr\\%';


EOSQL
